## 5.1 Playbook com Vari√°veis
Instala o Apache corretamente dependendo do sistema operacional.

### üìå Resposta (playbook install_apache.yml)

```yaml
---
- name: Instalar Apache em diferentes distribui√ß√µes
  hosts: all
  become: yes
  vars:
    apache_package:
      RedHat: httpd
      Debian: apache2
  tasks:
    - name: Instalar o pacote correto do Apache
      package:
        name: "{{ apache_package[ansible_os_family] }}"
        state: present
```

### ‚úÖ Explica√ß√£o
A vari√°vel apache_package define os nomes corretos do pacote para diferentes distribui√ß√µes.
O ansible_os_family √© usado para selecionar o nome correto (httpd para RedHat/CentOS, apache2 para Debian/Ubuntu).

## 5.2 Playbook com Vari√°veis
```yaml
---
- name: Garantir que os servi√ßos corretos estejam rodando
  hosts: all
  become: yes
  vars:
    services:
      dev: nginx
      staging:
        Debian: apache2
        RedHat: httpd
      prod: haproxy
  tasks:
    - name: Definir o servi√ßo correto com base no ambiente
      set_fact:
        service_name: >-
          {{ services[ansible_env.ENVIRONMENT][ansible_os_family]
             if services[ansible_env.ENVIRONMENT] is mapping
             else services[ansible_env.ENVIRONMENT] }}

    - name: Garantir que o servi√ßo est√° rodando e habilitado
      service:
        name: "{{ service_name }}"
        state: started
        enabled: yes
```

## 5.3 Playbook com Vari√°veis
```yaml
---
- name: Criar diret√≥rio de logs customizado
  hosts: all
  become: yes
  vars:
    log_directory: "/var/log/app"
    log_owner: "appuser"
    log_group: "appgroup"
    log_permissions: "0755"
  tasks:
    - name: Criar o grupo se n√£o existir
      group:
        name: "{{ log_group }}"
        state: present

    - name: Criar usu√°rio se n√£o existir
      user:
        name: "{{ log_owner }}"
        group: "{{ log_group }}"
        state: present

    - name: Criar diret√≥rio de logs com permiss√µes corretas
      file:
        path: "{{ log_directory }}"
        state: directory
        owner: "{{ log_owner }}"
        group: "{{ log_group }}"
        mode: "{{ log_permissions }}"
```

## 5.4 Configura√ß√£o de Templates Din√¢micos
```yaml
---
- name: Gerar configura√ß√£o YAML baseada no ambiente
  hosts: all
  become: yes
  vars:
    config_file: "/etc/app/config.yml"
  tasks:
    - name: Criar arquivo de configura√ß√£o a partir de um template
      template:
        src: templates/config.yml.j2
        dest: "{{ config_file }}"
        owner: root
        group: root
        mode: "0644"
```

-- templates/config.yml.j2
```yaml
app:
  name: MeuApp
  environment: {{ ansible_env.ENVIRONMENT | default('dev') }}
  database:
    host: {% if ansible_env.ENVIRONMENT == "prod" %}db.prod.local{% else %}db.dev.local{% endif %}
    user: app_user
    password: "{{ lookup('env', 'DB_PASSWORD') }}"
  logging:
    level: {% if ansible_env.ENVIRONMENT == "prod" %}ERROR{% else %}DEBUG{% endif %}
```
